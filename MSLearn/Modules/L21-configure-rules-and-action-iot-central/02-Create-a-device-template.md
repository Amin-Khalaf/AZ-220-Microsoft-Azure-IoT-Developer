# Create a Device Template

The data communicated between a remote device, and IoT Central, is specified in a device template. The device template specifies all the required details about the data, so that both the device and IoT Central have all they need to make sense of the communication.

In this unit, you will create a device template for a refrigerated truck. The IoT Central portal creates a simulated refrigerated truck device for you by default. This simulated device allows you to do some testing of the template before committing to real devices. In the unit that follows this one, you will examine this first level of testing.

## Create a Device Template

1. Within the [Azure IoT Central](https://apps.azureiotcentral.com/) portal (which you may still have open), select **Device Templates** from the menu on the left-hand side.

1. On the right-hand side of the screen, click **+** to create a new template.

1. You will next see a range of **New Template** options, select **Custom**.

    >**Tip:** Take note of the other options: **MXChip**, **Raspberry Pi**, and other hardware solutions. You may want to use those template options in a future project!

1. Enter the name for your template: "RefrigeratedTruck", then click **Create**.

1. You should now see a template **RefrigeratedTruck (1.0.0)**, and see that a template can consist of **Measurements**, **Settings**, **Properties**, **Commands**, **Rules**, and a **Dashboard**. Our refrigerated truck will need entries under most of these headings.

    > [!NOTE] You are creating this template with all you need for the units that follow this one. If the purpose of these entries is not immediately obvious, it should become clear as you work through this set of units. It is possible to complete a template, then come back to it and add more entries later, but this can involve managing multiple versions of a template, which is a small complexity, but one avoided in this Learn module. In the sections that follow, if an entry in the IoT Central portal is not mentioned in the text, it is safe to leave it at its default setting.

## Measurements

Measurements are data transmitted by the device, and cover four types of values: *Telemetry*, *State*, *Event*, and *Location*. Our scenario requires at least one of each of these types for the refrigerated truck. You need to go through the measurements carefully and enter all the required data. The most important entry is the **Field Name**. Make sure to enter this text accurately, as it is used when devices communicate values to the IoT Central app. When you write code in some of the following units, the reference in the code and the **Field Name** *must* be an exact match.

### Telemetry

Telemetry is the values transmitted by sensors. You only implemented one sensor in this scenario, the temperature of a truck's contents. The frequency with which this information is transmitted is determined by the device. In order for an operator to respond to an abnormal situation, the frequency of the transmission will need to be set appropriately.

Notice that minimum and maximum values are specified for a telemetry entry, these values are only used by a simulated device to mimic the values from a real device. A real device can transmit any value. The units of the telemetry are a text value to show on charts and tables, IoT Central does not have any inherent understanding of degrees Celsius, or any other possible physical unit.

1. On the "RefrigeratedTruck" device template page, ensure the **Measurements** option is underlined in blue.

1. To add a new telemetry item, click **+ New** and select **Telemetry** from the drop-down list.

    The **Create Telemetry** form will be displayed.

1. On the **Create Telemetry** form, under **Display Name**, enter **Contents temperature**.

1. Under **Field Name**, enter **temperature**.

1. Under **Units**, enter **degC**.

1. Under **Minimum Value**, enter **-20**.

1. Under **Maximum Value**, enter **20**.

1. Under **Decimal Places**, enter **1**.

1. At the top of the **Create Telemetry** form, click **Save**.

    The form will close.

    > [!NOTE] If you are warned you are leaving a page with unsaved changes, it often means you have neglected to click the **Save** icon.

You should now see a **Waiting for data** screen. This message is as it should be for a minute or so, but after a while you will start to see simulated values generated by IoT Central.

Let's add the rest of the template.

### State

States are important, they let the operator know what is going on. A state in IoT Central is a name associated with any number of values. In addition, you get to choose a color to associate with each value, which can make identifying what is going on (in particular, changes in state), much easier to identify in a visual display. It is easy to see why color is important, for example a "go" state might be a green color, a "failed" state a red or darker color, and so on.

1. To add a state for the truck's refrigerated contents, click **+ New** and select **State** from the drop-down list.

    The **Create State** form will be displayed.

1. On the **Create State** form, under **Display Name**, enter **Contents state**.

1. Under **Field Name**, enter **stateContents**.

1. To the right of **Values**, to add a value, click **+**.

1. In the **New Value** area, in the **Enter value** textbox, enter **empty**.

    As the **Display Name** is optional, you can leave that blank. Also, you can either accept the default color, or click the colored circle and choose an alternate color if you wish.

1. Repeat the previous two steps twice more, to add two more values for **full** and **melting**.

1. Once you have added the three values, at the top of the **Create State** form, click **Save**.

    The form will close.

To add some uncertainty to our simulation, let's add a failure state for the cooling system. If the cooling system fails, as you will see in the following units, the chances of the contents melting increase considerably!

1. To add a new state for the cooling system, click **+ New** and select **State** from the drop-down list.

    The **Create State** form will be displayed.

1. On the **Create State** form, under **Display Name**, enter **Cooling system**.

1. Under **Field Name**, enter **stateCoolingSystem**.

1. To the right of **Values**, to add a value, click **+**.

1. In the **New Value** area, in the **Enter value** textbox, enter **failed**.

    As the **Display Name** is optional, you can leave that blank. Also, you can either accept the default color, or click the colored circle and choose an alternate color if you wish.

1. Repeat the previous two steps twice more, to add two more values for **on** and **off**.

1. Once you have added the three values, at the top of the **Create State** form, click **Save**.

    The form will close.

A more complex state is the state of the truck itself. If all goes well, a truck's normal routing might be: ready, enroute, delivering, returning, loading, and back to ready again. However, you should add the dumping state to cater for when melted contents need to be disposed of! 

1. To add a new state for the truck, click **+ New** and select **State** from the drop-down list.

    The **Create State** form will be displayed.

1. On the **Create State** form, under **Display Name**, enter **Truck state**.

1. Under **Field Name**, enter **stateTruck**.

1. To the right of **Values**, to add a value, click **+**.

1. In the **New Value** area, in the **Enter value** textbox, enter **ready**.

    As the **Display Name** is optional, you can leave that blank. Also, you can either accept the default color, or click the colored circle and choose an alternate color if you wish.

1. Repeat the previous two steps five times more, to add two more values for **enroute**, **delivering**, **returning**, **loading** and **dumping**.

1. Once you have added the six values, at the top of the **Create State** form, click **Save**.

    The form will close.

### Event

Events are issues triggered by the device, and communicated to the IoT Central app. Events can be one of three types: *Error*, *Warning*, or *Informational*.

One possible event a device might trigger is a conflicting command. An example might be a truck is returning empty from a customer, but receives a command to deliver its contents to another customer. The conflict is caused by the device (the truck) being unable to act on the command. If a conflict occurs, it is a good idea for the device to trigger an event to warn the operator of the IoT Central app, with a *Warning* class of event.

1. To add a new warning event, click **+ New** and select **Event** from the drop-down list.

    The **Create Event** form will be displayed.

1. On the **Create Event** form, under **Display Name**, enter **Command conflict**.

1. Under **Field Name**, enter **eventConflict**.

1. Under **Default Severity**, select **Warning**.

1. To save the event, at the top of the **Create State** form, click **Save**.

    The form will close.

A second event that you will add is informational. When a truck receives a command to deliver to a customer, and the truck is able to perform the unit, the truck triggers a change-of-customer-ID event. Add this event now.

1. To add a new informational event, click **+ New** and select **Event** from the drop-down list.

    The **Create Event** form will be displayed.

1. On the **Create Event** form, under **Display Name**, enter **Customer change**.

1. Under **Field Name**, enter **eventCustomer**.

1. Under **Default Severity**, select **Information**.

    > [!NOTE] One reason you add this event is to keep track of which truck is going to which customer. In a later unit, you implement multiple trucks and a single dashboard to monitor them, and having this event helps provide a record of what is going on.

1. To save the event, at the top of the **Create State** form, click **Save**.

    The form will close.

### Location

A location is probably the most important, and yet one of the easiest measurements to add to a device template. Under the hood, it consists of a latitude, longitude, and an optional altitude, for the device.

1. To add a new location, click **+ New** and select **Location** from the drop-down list.

    The **Create Location** form will be displayed.

1. On the **Create Location** form, under **Display Name**, enter **Location**.

1. Under **Field Name**, enter **location**.

1. To save the location, at the top of the **Create Location** form, click **Save**.

    The form will close.

You should now have completed adding all the measurements you need. Validate the measurements you have created against the following list:

* Telemetry
  * Contents temperature
* State
  * Contents state
  * Colling system
  * Truck state
* Event
  * Command conflict
  * Customer change
* Location
  * Location

If you spot any mistakes, go back and address them before continuing.

## Settings

A Setting contains device configuration data. In our refrigerated truck example, you are going to define an optimal temperature for the contents as a setting. This optimal temperature might conceivably change with different types of content, different weather conditions, or whatever might be appropriate. A setting has an initial default value, which may not need to be changed, but the ability to change it easily and quickly is there, if needed.

A setting is a single value. If more complex sets of data need to be transmitted to a device, a Command (see below) might be the more appropriate way of handling it.

1. To add a setting, click on the **Settings** title (just to the right of **Measurements**) under the device template name.

1. To add a single setting to set an optimal contents temperature, under **Library**, click **Number**. 

    The **Configure Number** form is displayed.

1. On the **Configure Number** form, under **Display Name**, enter **Optimal temperature**.

1. Under **Field Name**, enter **optimalTemperature**.

1. Under **Unit of Measure**, enter **degC**.

1. Under **Number of Decimal Places**, enter **1**.

1. Under **Minimum Value**, enter **-20**.

1. Under **Maximum Value**, enter **20**.

1. Under **Initial Value**, enter **-5**.

    The **Description** field is optional and may be left blank.

1. To save the setting, at the top of the **Configure Number** form, click **Save**.

    The form will close and the new number setting will be displayed.

## Properties

Properties of a device are typically constant values, that are communicated to the IoT Central app once when communication is first initiated. In our refrigerated truck scenario, a good example of a property would be the license plate of the truck, or some similar unique truck ID.

1. To add a property, click on the **Properties** title (just to the right of **Settings**) under the device template name.

1. To add a single Text property to contain a truck ID, under **Library**, click **Text**.

    The **Configure Text** form will be displayed.

1. On the **Configure Text** form, under **Display Name**, enter **Truck ID**.

1. Under **Field Name**, enter **truckId**.

1. Under **Trim Leading Spaces**, select **Off**.

1. Under **Trim Trailing Spaces**, select **Off**.

1. Under **Case Sensitivity in Comparison**, select **On**.

1. Under **Case Sensitivity in Data Entry**, select **Mixed**.

1. Under **Minimum Length**, enter **0**.

1. Under **Maximum Length**, enter **100**.

1. Under **Initial Value**, leave it empty.

1. Under **Required**, select **Off**.

    **Description** is optional an may be left blank.

1. To save the property, at the top of the **Configure Text** form, click **Save**.

    The form will close and the new property will be displayed.

## Commands

Commands are sent by the operator of the IoT Central app to the remote devices. Commands are similar to settings, but a command can contain no, or multiple, input fields if necessary, whereas a setting is limited to a single value.

For refrigerated trucks, there are two commands you should add: a command to deliver the contents to a customer (identified by a customer ID), and a command to recall the truck to base.

1. To add a command, click on the **Commands** title (just to the right of **Properties**) under the device template name.

1. To add a command to send the truck to a customer, click **+ New Command**.

    The **Configure Command** form will be displayed.

1. On the **Configure Command** form, under **Display Name**, enter **Go to customer**.

1. Under **Field Name**, enter **cmdGoTo**.

1. To the right of the **Input Fields** title, to add an input field, click **+**.

1. On the **New Command Param** form, under **Display Name**, enter **Customer ID**.

1. Under **Field Name**, enter **customerId**.

1. Under **Data Type**, select **text**.

1. Under **Value**, leave blank.

1. To save the command and command parameter, at the top of the **Configure Command** form, click **Save**.

    The form will close and the new command will be displayed. You should see that the **Go to customer** command has a textbox to enter a Customer ID, a **Run** button as well as an area to display messages.

    >**Tip:**  If you move your mouse over lower-right corner of the box displaying the command, you can use the corner icon to stretch the bounding rectangle so that all elements of the command are displayed fully.


1. To add a command to recall the truck, click **+ New Command**.

    The **Configure Command** form will be displayed.

1. On the **Configure Command** form, under **Display Name**, enter **Recall**.

1. Under **Field Name**, enter **cmdRecall**.

    This command does not require a parameter.

1. To save the command, at the top of the **Configure Command** form, click **Save**.

    The form will close and the new command will be displayed. You should see that the **Recall** command just has a **Run** button and an area to display messages - as there are no parameters, there are no data entry fields.

As you have seen, preparing a device template does take some care and some time.

In the next unit, you can do some validation of our device template.